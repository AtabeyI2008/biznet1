// RESTAURANTS MANAGEMENT SYSTEM
class RestaurantsSystem {
    constructor() {
        this.restaurants = [];
        this.filteredRestaurants = [];
        this.currentFilters = {
            type: 'all',
            cuisine: '',
            location: '',
            priceRange: '',
            jobType: '',
            features: [],
            services: [],
            hours: [],
            payment: []
        };
        this.currentSort = 'rating';
        this.currentPage = 1;
        this.restaurantsPerPage = 8;
        this.init();
    }

    init() {
        this.loadRestaurants();
        this.setupEventListeners();
        this.renderRestaurants();
        console.log('üçΩÔ∏è Restaurants system initialized');
    }

    loadRestaurants() {
        this.restaurants = JSON.parse(localStorage.getItem('biznet_restaurants')) || this.getSampleRestaurants();
        this.filteredRestaurants = [...this.restaurants];
    }

    getSampleRestaurants() {
        return [
            {
                id: 1,
                name: 'Lezzet Restoran',
                type: 'restaurant',
                cuisine: 'turkish',
                location: 'Bakƒ±',
                activeJobs: 8,
                description: '∆èn l…ôziz t√ºrk m…ôtb…ôxi. ∆èn yax≈üƒ± keyfiyy…ôt v…ô xidm…ôt. 5 ildir bazar lideri.',
                logo: 'https://cdn-icons-png.flaticon.com/512/878/878052.png',
                rating: 4.8,
                reviewCount: 234,
                features: ['delivery', 'takeaway', 'terrace', 'parking', 'wifi', 'alcohol'],
                services: ['fine-dining', 'family', 'catering'],
                hours: '24h',
                payment: ['cash', 'card', 'online'],
                jobs: [
                    { position: 'A≈üpaz', salary: '‚Çº 800-1200' },
                    { position: 'Ofisiant', salary: '‚Çº 400-600' },
                    { position: 'Kassir', salary: '‚Çº 350-500' }
                ],
                priceRange: '‚Çº‚Çº',
                workingHours: {
                    monday: '09:00 - 00:00',
                    tuesday: '09:00 - 00:00',
                    wednesday: '09:00 - 00:00',
                    thursday: '09:00 - 00:00',
                    friday: '09:00 - 02:00',
                    saturday: '09:00 - 02:00',
                    sunday: '09:00 - 00:00'
                },
                featured: true,
                premium: true,
                delivery: true,
                phone: '+994 12 345 67 89',
                address: 'Nizami k√º√ß…ôsi 123'
            },
            {
                id: 2,
                name: 'Fresh Market',
                type: 'market',
                cuisine: 'local',
                location: 'G…ônc…ô',
                activeJobs: 5,
                description: 'T…ôz…ô t…ôr…ôv…ôz, meyv…ô v…ô …ôrzaq m…ôhsullarƒ±. ∆èn yax≈üƒ± qiym…ôtl…ôr.',
                logo: 'https://cdn-icons-png.flaticon.com/512/3075/3075977.png',
                rating: 4.6,
                reviewCount: 156,
                features: ['parking'],
                services: ['family'],
                hours: '07:00 - 23:00',
                payment: ['cash', 'card'],
                jobs: [
                    { position: 'Satƒ±≈ü k√∂m…ôk√ßisi', salary: '‚Çº 350-450' },
                    { position: 'Kassir', salary: '‚Çº 300-400' },
                    { position: 'Anbar i≈ü√ßisi', salary: '‚Çº 400-500' }
                ],
                priceRange: '‚Çº',
                workingHours: {
                    monday: '07:00 - 23:00',
                    tuesday: '07:00 - 23:00',
                    wednesday: '07:00 - 23:00',
                    thursday: '07:00 - 23:00',
                    friday: '07:00 - 23:00',
                    saturday: '07:00 - 23:00',
                    sunday: '08:00 - 22:00'
                },
                featured: false,
                premium: false,
                delivery: false,
                phone: '+994 22 345 67 89',
                address: '≈ûah ƒ∞smayƒ±l X…ôtai pr. 45'
            },
            {
                id: 3,
                name: 'Pizza Palace',
                type: 'restaurant',
                cuisine: 'italian',
                location: 'Bakƒ±',
                activeJobs: 6,
                description: '∆èn l…ôziz italyan pizzalarƒ±. H…ôqiqi italyan reseptl…ôri.',
                logo: 'https://cdn-icons-png.flaticon.com/512/6978/6978255.png',
                rating: 4.7,
                reviewCount: 189,
                features: ['delivery', 'takeaway', 'wifi'],
                services: ['family', 'buffet'],
                hours: '10:00 - 00:00',
                payment: ['cash', 'card', 'online'],
                jobs: [
                    { position: 'Pizza a≈üpazƒ±', salary: '‚Çº 600-900' },
                    { position: 'Ofisiant', salary: '‚Çº 400-550' }
                ],
                priceRange: '‚Çº‚Çº',
                workingHours: {
                    monday: '10:00 - 00:00',
                    tuesday: '10:00 - 00:00',
                    wednesday: '10:00 - 00:00',
                    thursday: '10:00 - 00:00',
                    friday: '10:00 - 01:00',
                    saturday: '10:00 - 01:00',
                    sunday: '10:00 - 00:00'
                },
                featured: true,
                premium: false,
                delivery: true,
                phone: '+994 12 987 65 43',
                address: 'F√ºzuli k√º√ß…ôsi 78'
            },
            {
                id: 4,
                name: 'Sushi Master',
                type: 'restaurant',
                cuisine: 'asian',
                location: 'Bakƒ±',
                activeJobs: 4,
                description: '∆èn t…ôz…ô balƒ±q v…ô …ôn…ôn…ôvi yapon texnikalarƒ±. Professional ≈üefl…ôr.',
                logo: 'https://cdn-icons-png.flaticon.com/512/3082/3082019.png',
                rating: 4.9,
                reviewCount: 267,
                features: ['delivery', 'takeaway', 'wifi', 'alcohol'],
                services: ['fine-dining'],
                hours: '11:00 - 23:00',
                payment: ['cash', 'card', 'online'],
                jobs: [
                    { position: 'Su≈üi ≈üefi', salary: '‚Çº 1200-1800' },
                    { position: 'Ofisiant', salary: '‚Çº 500-700' }
                ],
                priceRange: '‚Çº‚Çº‚Çº',
                workingHours: {
                    monday: '11:00 - 23:00',
                    tuesday: '11:00 - 23:00',
                    wednesday: '11:00 - 23:00',
                    thursday: '11:00 - 23:00',
                    friday: '11:00 - 00:00',
                    saturday: '11:00 - 00:00',
                    sunday: '12:00 - 22:00'
                },
                featured: true,
                premium: true,
                delivery: true,
                phone: '+994 12 555 44 33',
                address: 'Neft√ßil…ôr pr. 156'
            },
            {
                id: 5,
                name: 'Burger House',
                type: 'fastfood',
                cuisine: 'american',
                location: 'Sumqayƒ±t',
                activeJobs: 3,
                description: '∆èn dadlƒ± burgerl…ôr v…ô kartof fri. S√ºr…ôtli xidm…ôt.',
                logo: 'https://cdn-icons-png.flaticon.com/512/3075/3075977.png',
                rating: 4.5,
                reviewCount: 134,
                features: ['delivery', 'takeaway'],
                services: ['fastfood'],
                hours: '08:00 - 02:00',
                payment: ['cash', 'card'],
                jobs: [
                    { position: 'Burger a≈üpazƒ±', salary: '‚Çº 400-600' },
                    { position: 'Kassir', salary: '‚Çº 300-450' }
                ],
                priceRange: '‚Çº',
                workingHours: {
                    monday: '08:00 - 02:00',
                    tuesday: '08:00 - 02:00',
                    wednesday: '08:00 - 02:00',
                    thursday: '08:00 - 02:00',
                    friday: '08:00 - 03:00',
                    saturday: '08:00 - 03:00',
                    sunday: '08:00 - 01:00'
                },
                featured: false,
                premium: false,
                delivery: true,
                phone: '+994 18 123 45 67',
                address: 'M.∆è.R…ôsulzad…ô k√º√ß…ôsi 89'
            },
            {
                id: 6,
                name: 'Coffee Lab',
                type: 'cafe',
                cuisine: 'european',
                location: 'Bakƒ±',
                activeJobs: 4,
                description: 'X√ºsusi qovrulmu≈ü kofe √ße≈üidl…ôri. Rahat atmosfer.',
                logo: 'https://cdn-icons-png.flaticon.com/512/924/924514.png',
                rating: 4.6,
                reviewCount: 178,
                features: ['wifi', 'terrace'],
                services: ['cafe'],
                hours: '07:00 - 23:00',
                payment: ['cash', 'card', 'online'],
                jobs: [
                    { position: 'Barista', salary: '‚Çº 500-700' },
                    { position: 'Ofisiant', salary: '‚Çº 400-550' }
                ],
                priceRange: '‚Çº‚Çº',
                workingHours: {
                    monday: '07:00 - 23:00',
                    tuesday: '07:00 - 23:00',
                    wednesday: '07:00 - 23:00',
                    thursday: '07:00 - 23:00',
                    friday: '07:00 - 00:00',
                    saturday: '08:00 - 00:00',
                    sunday: '08:00 - 22:00'
                },
                featured: false,
                premium: true,
                delivery: false,
                phone: '+994 12 777 88 99',
                address: 'R.Behbudov k√º√ß…ôsi 34'
            }
        ];
    }

    setupEventListeners() {
        // Quick filters
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.handleQuickFilter(e.target);
            });
        });

        // Advanced filters
        document.querySelectorAll('.filter-select').forEach(select => {
            select.addEventListener('change', (e) => {
                this.handleAdvancedFilter(e.target);
            });
        });

        // Checkbox filters
        document.querySelectorAll('.checkbox input').forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                this.handleCheckboxFilter(e.target);
            });
        });
    }

    handleQuickFilter(button) {
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        button.classList.add('active');
        
        const filterType = button.dataset.type;
        this.applyQuickFilter(filterType);
    }

    applyQuickFilter(filterType) {
        if (filterType === 'all') {
            this.filteredRestaurants = [...this.restaurants];
        } else {
            this.filteredRestaurants = this.restaurants.filter(restaurant => 
                restaurant.type === filterType
            );
        }
        
        this.renderRestaurants();
    }

    handleAdvancedFilter(select) {
        const filterName = select.id.replace('Filter', '').toLowerCase();
        const value = select.value;
        
        this.currentFilters[filterName] = value;
    }

    handleCheckboxFilter(checkbox) {
        const dataAttribute = Object.keys(checkbox.dataset)[0];
        const value = checkbox.dataset[dataAttribute];
        
        if (!this.currentFilters[dataAttribute]) {
            this.currentFilters[dataAttribute] = [];
        }
        
        if (checkbox.checked) {
            this.currentFilters[dataAttribute].push(value);
        } else {
            this.currentFilters[dataAttribute] = this.currentFilters[dataAttribute].filter(item => item !== value);
        }
    }

    applyFilters() {
        this.filteredRestaurants = this.restaurants.filter(restaurant => {
            // Type filter
            if (this.currentFilters.type !== 'all' && restaurant.type !== this.currentFilters.type) {
                return false;
            }
            
            // Cuisine filter
            if (this.currentFilters.cuisine && restaurant.cuisine !== this.currentFilters.cuisine) {
                return false;
            }
            
            // Location filter
            if (this.currentFilters.location && restaurant.location.toLowerCase() !== this.currentFilters.location) {
                return false;
            }
            
            // Features filter
            if (this.currentFilters.features.length > 0) {
                const hasAllFeatures = this.currentFilters.features.every(feature => 
                    restaurant.features.includes(feature)
                );
                if (!hasAllFeatures) return false;
            }
            
            return true;
        });
        
        this.sortRestaurants();
        this.renderRestaurants();
        this.updateResultsInfo();
    }

    handleSortChange(sortType) {
        this.currentSort = sortType;
        this.applyFilters();
    }

    sortRestaurants() {
        switch(this.currentSort) {
            case 'rating':
                this.filteredRestaurants.sort((a, b) => b.rating - a.rating);
                break;
            case 'newest':
                // ∆èlav…ô edil…ô bil…ôr
                break;
            case 'jobs':
                this.filteredRestaurants.sort((a, b) => b.activeJobs - a.activeJobs);
                break;
            case 'name':
                this.filteredRestaurants.sort((a, b) => a.name.localeCompare(b.name));
                break;
        }
    }

    resetFilters() {
        this.currentFilters = {
            type: 'all',
            cuisine: '',
            location: '',
            priceRange: '',
            jobType: '',
            features: [],
            services: [],
            hours: [],
            payment: []
        };
        
        document.querySelectorAll('.filter-select').forEach(select => {
            select.value = '';
        });
        
        document.querySelectorAll('.checkbox input').forEach(checkbox => {
            checkbox.checked = false;
        });
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.querySelector('.filter-btn[data-type="all"]').classList.add('active');
        
        this.filteredRestaurants = [...this.restaurants];
        this.renderRestaurants();
        this.updateResultsInfo();
    }

    renderRestaurants() {
        const restaurantsGrid = document.getElementById('restaurantsGrid');
        if (!restaurantsGrid) return;

        const startIndex = (this.currentPage - 1) * this.restaurantsPerPage;
        const endIndex = startIndex + this.restaurantsPerPage;
        const restaurantsToShow = this.filteredRestaurants.slice(startIndex, endIndex);

        if (restaurantsToShow.length === 0) {
            restaurantsGrid.innerHTML = this.getNoRestaurantsHTML();
            return;
        }

        restaurantsGrid.innerHTML = restaurantsToShow.map(restaurant => this.getRestaurantHTML(restaurant)).join('');
    }

    getRestaurantHTML(restaurant) {
        const cuisineNames = {
            'turkish': 'T√ºrk',
            'italian': 'ƒ∞talyan',
            'asian': 'Asiya',
            'american': 'Amerikan',
            'european': 'Avropa',
            'local': 'Yerli'
        };

        const typeNames = {
            'restaurant': 'Restoran',
            'market': 'Market',
            'cafe': 'Kafe',
            'fastfood': 'Fast Food'
        };

        return `
            <div class="restaurant-card ${restaurant.featured ? 'featured' : ''} ${restaurant.premium ? 'premium' : ''}">
                ${restaurant.premium ? '<div class="premium-badge">PREMIUM</div>' : ''}
                
                <div class="restaurant-header">
                    <img src="${restaurant.logo}" alt="${restaurant.name}" class="restaurant-logo">
                    <div class="restaurant-info">
                        <h3 class="restaurant-name">${restaurant.name}</h3>
                        <div class="restaurant-type">${typeNames[restaurant.type]} ‚Ä¢ ${cuisineNames[restaurant.cuisine]} m…ôtb…ôxi</div>
                        
                        <div class="restaurant-rating">
                            <span class="rating-stars">${this.getStarRating(restaurant.rating)}</span>
                            <span class="rating-count">${restaurant.rating} (${restaurant.reviewCount} r…ôy)</span>
                        </div>

                        <div class="restaurant-meta">
                            <span class="restaurant-location">üìç ${restaurant.location}</span>
                            <span class="restaurant-cuisine">üçΩÔ∏è ${cuisineNames[restaurant.cuisine]}</span>
                            <span class="restaurant-jobs">üíº ${restaurant.activeJobs} a√ßƒ±q v…ôzif…ô</span>
                        </div>
                    </div>
                </div>

                ${restaurant.delivery ? '<div class="delivery-info">üöö √áatdƒ±rƒ±lma xidm…ôti m√∂vcuddur</div>' : ''}

                <p class="restaurant-description">${restaurant.description}</p>

                <div class="restaurant-features">
                    ${restaurant.features.map(feature => {
                        const featureIcons = {
                            'delivery': 'üöö',
                            'takeaway': 'üì¶',
                            'terrace': 'üåø',
                            'parking': 'üÖøÔ∏è',
                            'wifi': 'üì∂',
                            'alcohol': 'üç∑'
                        };
                        return `<span class="feature-tag">${featureIcons[feature]} ${feature}</span>`;
                    }).join('')}
                </div>

                <div class="working-hours">
                    <div class="hours-title">‚è∞ ƒ∞≈ü saatlarƒ±</div>
                    <div class="hours-list">
                        <div class="hour-item">
                            <span>B.e - C.…ô</span>
                            <span>${restaurant.workingHours.monday}</span>
                        </div>
                        <div class="hour-item">
                            <span>≈û…ônb…ô</span>
                            <span>${restaurant.workingHours.saturday}</span>
                        </div>
                        <div class="hour-item">
                            <span>Bazar</span>
                            <span>${restaurant.workingHours.sunday}</span>
                        </div>
                    </div>
                </div>

                <div class="restaurant-jobs-list">
                    <div class="jobs-title">üìã A√ßƒ±q V…ôzif…ôl…ôr</div>
                    <div class="job-items">
                        ${restaurant.jobs.map(job => `
                            <div class="job-item">
                                <span class="job-position">${job.position}</span>
                                <span class="job-salary">${job.salary}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="restaurant-footer">
                    <div class="price-range">${restaurant.priceRange}</div>
                    <div class="restaurant-actions">
                        <a href="tel:${restaurant.phone}" class="view-menu-btn">
                            üìû Z…ông et
                        </a>
                        <a href="jobs.html?restaurant=${restaurant.id}" class="apply-jobs-btn">
                            üíº M√ºraci…ôt et
                        </a>
                        <a href="messages.html?to=restaurant_${restaurant.id}" class="contact-btn">
                            üíå Mesaj g√∂nd…ôr
                        </a>
                    </div>
                </div>
            </div>
        `;
    }

    getNoRestaurantsHTML() {
        return `
            <div class="no-restaurants">
                <div class="no-restaurants-icon">üçΩÔ∏è</div>
                <h3>He√ß bir restoran v…ô ya market tapƒ±lmadƒ±</h3>
                <p>Filter parametrl…ôrini d…ôyi≈üin v…ô ya daha sonra yoxlayƒ±n</p>
                <button class="reset-filters-btn" onclick="restaurantsSystem.resetFilters()">Filterl…ôri Sƒ±fƒ±rla</button>
            </div>
        `;
    }

    getStarRating(rating) {
        const fullStars = '‚òÖ'.repeat(Math.floor(rating));
        const halfStar = rating % 1 >= 0.5 ? '‚≠ê' : '';
        const emptyStars = '‚òÜ'.repeat(5 - Math.ceil(rating));
        return fullStars + halfStar + emptyStars;
    }

    updateResultsInfo() {
        const resultsInfo = document.querySelector('.results-info');
        if (resultsInfo) {
            const count = this.filteredRestaurants.length;
            resultsInfo.innerHTML = `
                <h3>${count} restoran v…ô market tapƒ±ldƒ±</h3>
                <p>Filterl…ôri t…ôtbiq etdiniz</p>
            `;
        }
    }
}

// Initialize restaurants system
document.addEventListener('DOMContentLoaded', () => {
    window.restaurantsSystem = new RestaurantsSystem();
});